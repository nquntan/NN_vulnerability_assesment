import numpy  as np
import torch
import matplotlib
matplotlib.use('Agg')
import matplotlib.pyplot as plt
import numpy as np
import seaborn as sns
sns.set_style('white')
import pandas as pd
from art.utils import load_dataset

classes = ('plane', 'car', 'bird', 'cat',
           'deer', 'dog', 'frog', 'horse', 'ship', 'truck')
    
def plot_images(images, filename):
    # npimg = img.numpy()
    fontsize = 24
    col = 2
    row = len(images)//2    
    fig = plt.figure(figsize=(16, 10))
    for i in range(0, len(images)):
        fig.add_subplot(row, col, i+1)
        plt.imshow(np.transpose(images[i], (1, 2, 0)))
    plt.savefig(f"./result/plots/{filename}")


def plot_image(image, filename):
    plt.imshow(np.transpose(image, (1, 2, 0)))
    plt.savefig(f"./result/plots/{filename}")

def load_data():
    (x_train, y_train), (x_test, y_test), min_, max_ = load_dataset(str('cifar10'))
    x_train = np.swapaxes(x_train, 1, 3).astype(np.float32)
    x_test = np.swapaxes(x_test, 1, 3).astype(np.float32)

    return (x_train, y_train), (x_test, y_test), min_, max_ 

def loss_fn(pred_y, current_y, mode = "l2"):
    if mode == "l2":
        return np.linalg.norm(pred_y - current_y, ord=2)
    elif mode == "fool_rate":
        y_max = np.argmax(pred_y, axis=1)
        cullent_label = np.argmax(current_y, axis=1)
        return np.sum(y_max != cullent_label) / len(y_max)

def split_list(l, n):
    for idx in range(0, len(l), n):
        yield l[idx:idx + n]


if __name__ == '__main__':
    (x_train, y_train), (x_test, y_test), min_, max_ = load_data()
    # print(len(x_train))
    plot_image(x_train[0:4], "sample.png")